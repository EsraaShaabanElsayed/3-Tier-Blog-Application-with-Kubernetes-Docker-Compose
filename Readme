 Blog Application - OpenShift Deployment

A three-tier blog application deployed on OpenShift with Nginx reverse proxy, Go backend, and MySQL database.

### ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Internet  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ NodePort (30080/30443)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Nginx Reverse Proxy            â”‚
â”‚  - HTTP â†’ HTTPS redirect        â”‚
â”‚  - TLS termination              â”‚
â”‚  - Port 8080 (HTTP)             â”‚
â”‚  - Port 8443 (HTTPS)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“ Port 8000
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Go Backend API                 â”‚
â”‚  - REST API                     â”‚
â”‚  - Business logic               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“ Port 3306
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL Database                 â”‚
â”‚  - StatefulSet with PVC         â”‚
â”‚  - Persistent storage           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ Components

### 1. **Nginx Proxy** (Deployment)
- **Image:** `nginx:1.25-alpine`
- **Ports:** 
  - 8080 (HTTP - redirects to HTTPS)
  - 8443 (HTTPS with TLS)
- **Service Type:** NodePort (30080, 30443)
- **Features:**
  - Automatic HTTP to HTTPS redirect
  - TLS/SSL termination
  - Reverse proxy to backend
  - Custom configuration via ConfigMap

### 2. **Backend API** (Deployment)
- **Image:** `esraa114/blog-app-backend`
- **Port:** 8000
- **Service Type:** ClusterIP
- **Features:**
  - Go-based REST API
  - Secret management for database credentials
  - ServiceAccount integration

### 3. **MySQL Database** (StatefulSet)
- **Image:** `mysql:8.0`
- **Port:** 3306
- **Service Type:** Headless ClusterIP
- **Storage:** PersistentVolumeClaim (`mysql-pvc`)
- **Features:**
  - Stateful deployment for data persistence
  - Security hardened (non-root, dropped capabilities)
  - Health probes (liveness and readiness)
  - Resource limits defined

## ğŸ” Security Features

- **ServiceAccount:** Custom service account (`blog-app-sa`) for pod identity
- **Secrets Management:** 
  - Database passwords stored in `db-secret`
  - TLS certificates in `tls-secret`
- **Security Context:**
  - Non-root containers
  - Dropped all capabilities
  - Seccomp profile enforcement
  - Read-only root filesystem where applicable

## ğŸš€ Deployment

### Prerequisites
- OpenShift cluster (CRC or full cluster)
- `oc` CLI tool installed
- Database secret created
- TLS certificate secret created
- PersistentVolumeClaim for MySQL

### Quick Start

1. **Deploy Components (in order):**
```bash
# ServiceAccount
oc apply -f service-account.yaml

# Database
oc apply -f db-service.yaml
oc apply -f db-statefulset.yaml

# Backend
oc apply -f backend-service.yaml
oc apply -f app-deployment.yaml

# Proxy
oc apply -f nginx-configmap.yaml
oc apply -f proxy-deployment.yaml
oc apply -f proxy-service.yaml
```

2. **Verify Deployment:**
```bash
oc get all
oc get pvc
oc get secrets
```

## ğŸŒ Accessing the Application

### Via NodePort (External Access)
- **HTTP:** `http://<node-ip>:30080` (redirects to HTTPS)
- **HTTPS:** `https://<node-ip>:30443`

### Get Node IP (CRC):
```bash
crc ip
```

### Example:
```bash
# HTTP (will redirect with 301)
curl http://192.168.130.11:30080

# HTTPS (returns blog posts)
curl -k https://192.168.130.11:30443
```

### Expected Output:
```bash
# HTTP response (301 redirect)
<html>
<head><title>301 Moved Permanently</title></head>
<body>
<center><h1>301 Moved Permanently</h1></center>
<hr><center>nginx/1.25.5</center>
</body>
</html>

# HTTPS response (blog data)
["Blog post #0","Blog post #1","Blog post #2","Blog post #3","Blog post #4"]
```

## ğŸ“Š Port Mapping

| Component | Container Port | Service Port | NodePort | Protocol |
|-----------|---------------|--------------|----------|----------|
| Nginx     | 8080          | 80           | 30080    | HTTP     |
| Nginx     | 8443          | 443          | 30443    | HTTPS    |
| Backend   | 8000          | 8000         | -        | HTTP     |
| MySQL     | 3306          | 3306         | -        | TCP      |

## ğŸ” Troubleshooting

### Check Pod Status
```bash
oc get pods
oc logs <pod-name>
oc describe pod <pod-name>
```

### Check Service Endpoints
```bash
oc get endpoints
oc describe svc <service-name>
```

### Port Forward for Testing
```bash
# Test backend directly
oc port-forward svc/backend 8000:8000
curl http://localhost:8000

# Test proxy
oc port-forward svc/proxy 8080:8080
curl http://localhost:8080
```


## ğŸ“ Configuration Files

```
openshift/
â”œâ”€â”€ service-account.yaml        # ServiceAccount for pods
â”œâ”€â”€ db-service.yaml             # MySQL headless service
â”œâ”€â”€ db-statefulset.yaml         # MySQL StatefulSet
â”œâ”€â”€ backend-service.yaml        # Backend ClusterIP service
â”œâ”€â”€ app-deployment.yaml         # Backend deployment
â”œâ”€â”€ nginx-configmap.yaml        # Nginx configuration
â”œâ”€â”€ proxy-deployment.yaml       # Nginx deployment
â””â”€â”€ proxy-service.yaml          # Nginx NodePort service
```
